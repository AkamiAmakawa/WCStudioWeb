<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News</title>
    <link rel="stylesheet" href="/css/news.css">
    <link rel="stylesheet" href="/fonts/themify-icons/themify-icons.css">
</head>
<body>
    <div id="main">
      <div id="header">
        <%- include("./partials/navbar.ejs")%>
      </div>

      
    </div>

<!-- edit/delete button     -->
<%  hidden = "";
 if (!user || (data.authorId != user.id)) { 
    hidden = "hidden";
 } %>
<!-- <a href="/edit_article/<%= data.id%>"><button class = "<%=hidden%>">Edit</button></a>
<button onclick="delConfirm()" class = "<%=hidden%>">Remove</button> -->

        <div id="content">
            <article>
              <h1 class="titledetail">
                <%= data.a_name %>
              </h1>

              <div class="userdetail">
                <a href="/user/<%=data.UserAccount.username %>"><%= data.UserAccount.userInfo.displayName%></a>

                <span>
                  <%= data.createdAt %>
                </span>
              </div>
              <p><%- data.content %></p>
            </article>
        </div>

        <div class="btn-group dropup">
          <button class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Setting
          </button>
          <div class="dropdown-menu <%= hidden %>" aria-labelledby="dropdownMenuButton">
            <a href="/edit_article/<%= data.id%>"><button class = "dropdown-item">Edit</button></a>
            <button onclick="delConfirm()" class = "dropdown-item">Remove</button>
          </div>
        </div>

        <div class="container-fluid">
          <h3>Comment section</h3>
          <ul class="list-group" id="posted-comment">

          </ul>
          <% if (user){ %>
          <div class="form-group">
            <form action="/a/<%= data.id %>" method="POST">
            <input type="hidden" name = "articleId" id="articleId" value="<%= data.id%>">    
            <input type="hidden" name = "authorId" id="authorId" value="<%= user.id%>">   
            <input type="text" class="form-control" name="comment" id="comment" placeholder="Say something!">
          </div>
          <button type="submit" class="btn btn-outline-primary" id="submit-button">Submit</button>
        </form>
        <%} %>

                
        <% commentList.forEach(comment => { %>
            <div class="text-justify darker mt-4 float-right"> <img src="https://i.imgur.com/CFpa3nK.jpg" alt="" class="rounded-circle" width="40" height="40">
                    <a href="/user/<%=comment.UserAccount.username%>">
                      <%= comment.UserAccount.userInfo.displayName %>
                      <a> <span>- <%= comment.createdAt%></span> <br>
                    <p><%=comment.content%></p>
                </div>
          <%}); %>
          </ul>
        </div>

        
        <!-- Script -->
<script>
  function delConfirm() {
  if(confirm("Do you want to delete this article?")){
    document.location.href = "/remove_article/<%= data.id %>";
  }
}
</script>

<!-- Footer -->
        <%- include("./partials/footer.ejs")%>;
<!-- Footer -->
    </div>
</body>
</html>